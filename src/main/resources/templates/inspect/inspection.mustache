{{> common/header}}
<link rel="stylesheet" href="/css/sidebarstyles.css">
<link rel="stylesheet" href="/css/headerstyles.css">

<style>
    /* âœ… ì¤‘ì•™ ì •ë ¬ */
    .container {
        display: flex;
        flex-direction: column; /* ì´ë¯¸ì§€ ê²€ìˆ˜, ê³¼ì • ë°•ìŠ¤ ì •ë ¬ ì„¸ë¡œ */
        /*margin-left: -500px; */
        justify-content: center;  /* í™”ë©´ ì¤‘ì•™ ì •ë ¬ */
    }

    .content {
        flex: 1;
        padding: 20px;
        text-align: center;
        width: calc(100% - 220px); /* ì‚¬ì´ë“œë°” ë„ˆë¹„ ì œì™¸ */
        margin-left: 220px; /* ì‚¬ì´ë“œë°” í¬ê¸°ë§Œí¼ ì™¼ìª½ì—ì„œ ì´ë™ */
        overflow: hidden; /* ë„˜ì¹˜ëŠ” ë¶€ë¶„ì„ ìˆ¨ê¹€ */
    }

    .image-wrapper h4 {
        margin-top: 9px;
        color: #615f61; /* ê¸€ì ìƒ‰ìƒì„ í°ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
    }

    /* ì´ë¯¸ì§€ í¬ê¸° ì¡°ì • */
    .image-wrapper img {
        width: auto;
        max-width: 100%; /* í™”ë©´ í¬ê¸°ë¥¼ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì œí•œ */
        height: auto;
        border: 2px solid #ccc;
        margin-top: 10px;
    }

    /* âœ… ì—¬ë°± ì¶”ê°€ */
    #uploadForm {
        margin-bottom: 20px;
    }

    /* âœ… ê²°ê³¼ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    #resultContainer {
        display: none;
        margin-top: 20px;
    }

    .image-container {
        display: flex;
        justify-content: center;
        gap: 50px;
    }

    /* ğŸ”¥ ì´ë¯¸ì§€ê°€ ë“¤ì–´ê°ˆ ë°•ìŠ¤ (ê³ ì • í¬ê¸°) */
    .image-box {
        width: 300px;  /* ë°•ìŠ¤ ë„ˆë¹„ */
        height: 300px; /* ë°•ìŠ¤ ë†’ì´ */
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid #ddd; /* í…Œë‘ë¦¬ ì¶”ê°€ */
        background-color: #f8f8f8; /* ë°°ê²½ ì¶”ê°€ */
        border-radius: 8px; /* ë‘¥ê·¼ í…Œë‘ë¦¬ */
        overflow: hidden; /* ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ë„˜ì–´ê°€ì§€ ì•Šê²Œ */
    }

    /* ğŸ”¥ ì´ë¯¸ì§€ê°€ ë°•ìŠ¤ ì•ˆì— ë§ê²Œ ë“¤ì–´ê°€ë„ë¡ ì¡°ì ˆ */
    .image-box img {
        width: 100%;
        height: 100%;
        object-fit: contain; /* ì´ë¯¸ì§€ê°€ ì˜ë¦¬ì§€ ì•Šê³  ë§ì¶°ì§ */
    }


    h3 {
        font-size: 1.8rem;
        font-weight: bold;
        text-align: center;
        margin-bottom: 16px; /* âœ… ì•„ë˜ ì—¬ë°± ì¶”ê°€ */
        display: inline-block;
        color: rgba(40, 40, 43, 0.78);
    }


    .icon-container { /* ê³¼ì • ë°•ìŠ¤ ì•„ì´ì½˜ ì „ì²´ */
        position: sticky;
        display: flex;
        justify-content: center;
        gap: 20px;
        padding: 12px 80px; /* âœ… ìƒí•˜, ì¢Œìš° ì—¬ë°± */
        background-color: #f8f9fa; /*  ë°°ê²½ ìƒ‰ìƒ */
        border-radius: 12px; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1); /* ë¶€ë“œëŸ¬ìš´ ê·¸ë¦¼ì íš¨ê³¼ */
        margin-top: 82px; /* ê³¼ì •ë°•ìŠ¤, ì´ë¯¸ì§€ ê²€ìˆ˜ ê°™ì´. ë‚´ë ¤ê³  */
        margin-bottom: 90px; /* ì•„ì´ì½˜ê³¼ ì´ë¯¸ì§€ ê²€ìˆ˜ ì‚¬ì´ ê°„ê²©. ë‚´ë ¤ê³ */
        margin-left: 225px;

    }

    .icon-box img, .icon-box-frame img {
        width: 65px; /* ê³¼ì • ì•„ì´ì½˜ í¬ê¸° */
        height: 65px;
        margin-left: 47px;
        margin-right: 47px;
    }
    .icon-box-yolo img {
        width: 150px; /* ê³¼ì • ì•„ì´ì½˜ í¬ê¸° */
        height: auto;
        margin-top: 10px;
    }
    .icon-box-shift img {
        width: 40px; /* ì´ë™ ì•„ì´ì½˜ í¬ê¸° */
        height: auto;
    }
    .icon-box-shift-start img {
        width: 40px; /* ì´ë™ ì•„ì´ì½˜ í¬ê¸° */
        height: auto;
    }
    .icon-box p { /* ì•„ì´ì½˜ ê¸€ì */
        margin-top: 10px;
        margin-left : 42px;
        font-size: 16px;
    }

    .icon-box-frame p { /* ì•„ì´ì½˜ ê¸€ì */
        margin-top: 10px;
        margin-left : 35px;
        font-size: 16px;
    }

    .icon-box-yolo p { /* yolo ì•„ì´ì½˜ ê¸€ì */
        margin-top: 14px;
        margin-left : 50px;
        font-size: 16px;
    }

    @keyframes wipeEffect { /* ì•„ì´ì½˜ ê¹œë¹¡ */
        0% { clip-path: inset(0% 100% 0% 0%); opacity: 1; }
        100% { clip-path: inset(0% 0% 0% 0%); opacity: 1;  }
    }

    /* ê¸°ë³¸ ìƒíƒœì—ì„œëŠ” ê¹œë°•ì´ì§€ ì•ŠìŒ */
    .icon-box-shift-start img {
        width: 40px; /* ì´ë™ ì•„ì´ì½˜ í¬ê¸° */
        height: auto;
        display: block; /* ê¸°ë³¸ì ìœ¼ë¡œ ë³´ì´ê²Œ ì„¤ì • */
    }

    /* ê¹œë°•ì´ëŠ” ì•„ì´ì½˜ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) */
    .blink-shift {
        width: 89px !important;
        height: auto;
        display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
        animation: wipeEffect 0.5s infinite; /* 1ì´ˆë§ˆë‹¤ ë¬´í•œ ë°˜ë³µ */
    }
    /* âœ… íŒŒì¼ ì—…ë¡œë“œ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë°•ìŠ¤ */
    .drop-zone {
        width: 500px;  /* ê¸°ì¡´ë³´ë‹¤ ë” ë„“ê²Œ ì¡°ì ˆ */
        height: 230px; /* ë†’ì´ ì¡°ì ˆ */
        border: 2px dashed #ccc; /* ì ì„  ìŠ¤íƒ€ì¼ ì ìš© */
        border-radius: 0px; /* ëª¨ì„œë¦¬ ë‘¥ê¸€ê²Œ */
        background-color: #f9f9f9; /* ë°°ê²½ ìƒ‰ìƒ */
        text-align: center;
        display: flex;
        flex-direction: column; /* í…ìŠ¤íŠ¸ì™€ ì•„ì´ì½˜ì„ ì„¸ë¡œ ì •ë ¬ */
        align-items: center; /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
        justify-content: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
        cursor: pointer;
        transition: all 0.3s ease-in-out;

        margin-left: 200px;
    }

    /* âœ… íŒŒì¼ ë“œë˜ê·¸ ìƒíƒœì¼ ë•Œ íš¨ê³¼ */
    .drop-zone.dragover {
        border-color: #007bff;
        background-color: #eef5ff;
        animation: glowBorder 0.7s infinite alternate;
    }

    @keyframes glowBorder {
        0% {
            box-shadow: 0px 0px 5px rgba(0, 123, 255, 0.5);
        }
        100% {
            box-shadow: 0px 0px 15px rgba(0, 123, 255, 0.8);
        }
    }

    /* âœ… ì•„ì´ì½˜ í¬ê¸° ì¡°ì • */
    .drop-zone img {
        width: 40px;
        height: auto;
        margin-bottom: 13px;
    }

    /* âœ… ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .upload-btn {
        margin-top: 10px;
        padding: 10px 20px;
        border: none;
        background-color: rgba(0, 34, 255, 0.78);
        color: white;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        margin-top: 20px;
        margin-bottom: 100px;
        margin-left: 310px;
    }

    .upload-btn:hover {
        background-color: #0056b3;
    }

    .change-btn {
        margin-top: 20px;
        padding: 10px 20px;
        border: none;
        background-color: #001fec;
        color: #efefef;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
    }

    .change-btn:hover {
        background-color: #00189c;
    }




</style>

<div class="container">
    {{> common/sidebar}}

    <div class="icon-container">
        <div class="icon-box">
            <img src="/img/cctv-icon.png" alt="CCTV">
            <p>CCTV</p>
        </div>
        <div class="icon-box-shift">
            <img src="/img/right-icon.png" alt="ì´ë™ì¤‘">
        </div>
        <div class="icon-box-frame">
            <img src="/img/frame-icon.png" alt="í”„ë ˆì„ ë¶„ë¦¬">
            <p>í”„ë ˆì„ ë¶„ë¦¬</p>
        </div>
        <div class="icon-box-shift">
            <img src="/img/right-icon.png" alt="ì´ë™ì¤‘">
        </div>
        <div class="icon-box-yolo">
            <img src="/img/yolo-icon.png" alt="YOLO">
            <p>YOLO</p>
        </div>
        <div class="icon-box-shift-start">
            <img id="defaultIcon" src="/img/right-icon.png" alt="ì´ë™ì¤‘">
            <img id="loadingIcon" class="blink-shift" src="/img/right_shift.png" alt="ë¡œë”©ì¤‘" style="display: none;">
        </div>
        <div class="icon-box">
            <img src="/img/classification-icon.png" alt="ë¬¼í’ˆ ë¶„ë¥˜">
            <p>ë¬¼í’ˆ ë¶„ë¥˜</p>
        </div>
    </div>

    <div class="content">
<!--        <h2>ì´ë¯¸ì§€ ê²€ìˆ˜</h2>-->

        <form id="uploadForm" enctype="multipart/form-data">
            <!-- âœ… ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë°•ìŠ¤ -->
            <label class="drop-zone" id="dropZone">
                <img src="/img/upload-icon.png" alt="Upload Icon">
                <p id="dropZoneText">ì—¬ê¸°ë¡œ íŒŒì¼ì„ ëŒì–´ì˜¤ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</p>
            </label>
            <!-- âœ… ìˆ¨ê²¨ì§„ íŒŒì¼ ì„ íƒ input -->
            <input type="file" id="fileInput" accept="image/*" style="display: none;">
            <button type="submit" class="upload-btn" id="uploadButton" disabled>ê²€ìˆ˜ ì‹œì‘</button>
        </form>

        <div id="resultContainer">
<!--          <h3>Fine-tuning the YOLO V11 model on goods & food data</h3>  -->
            <div class="image-container">
                <div class="image-wrapper">
                    <img id="originalImage" src="" alt="Original Image">
                    <h4>Default Image</h4>
                </div>
                <div class="image-wrapper">
                    <img id="detectedImage" src="" alt="Detected Image">
                    <h4>Detected Image</h4>
                </div>
            </div>
            <button id="changeButton" class="change-btn">ë‹¤ë¥¸ ì´ë¯¸ì§€ ì„ íƒ</button>
        </div>
    </div>
</div>

{{> common/footer}}

<script>
    const dropZone = document.getElementById("dropZone");
    const fileInput = document.getElementById("fileInput");
    const dropZoneText = document.getElementById("dropZoneText");
    const uploadButton = document.getElementById("uploadButton");

    //  íŒŒì¼ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ê¸°ëŠ¥ (íŒŒì¼ ì„ íƒë§Œ ìˆ˜í–‰)
    dropZone.addEventListener("dragover", (event) => {
        event.preventDefault();
        dropZone.classList.add("dragover");
    });

    dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("dragover");
    });

    dropZone.addEventListener("drop", (event) => {
        event.preventDefault();
        dropZone.classList.remove("dragover");

        if (event.dataTransfer.files.length) {
            fileInput.files = event.dataTransfer.files; // íŒŒì¼ ì €ì¥
            displayFileName(fileInput.files[0]); // íŒŒì¼ ì´ë¦„ í‘œì‹œ
        }
    });

    dropZone.addEventListener("click", () => {
        fileInput.click();
    });

    fileInput.addEventListener("change", () => {
        if (fileInput.files.length > 0) {
            displayFileName(fileInput.files[0]); // íŒŒì¼ ì´ë¦„ í‘œì‹œ
        }
    });

    // íŒŒì¼ ì´ë¦„ì„ ë„¤ëª¨ ë°•ìŠ¤ì— í‘œì‹œ
    function displayFileName(file) {
        dropZoneText.textContent = file.name; // íŒŒì¼ ì´ë¦„ í‘œì‹œ
        uploadButton.disabled = false; // ë²„íŠ¼ í™œì„±í™”
    }

    // âœ… ì—…ë¡œë“œ ì²˜ë¦¬
    document.getElementById("uploadForm").onsubmit = async function(event) {
        event.preventDefault();

        // ğŸ”¥ íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì‹¤í–‰ ì¤‘ë‹¨
        if (!fileInput.files.length) {
            alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            return;
        }

        // ì—…ë¡œë“œ í¼ê³¼ ê²€ìˆ˜ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        document.getElementById("uploadForm").style.display = "none";
        document.getElementById("uploadButton").style.display = "none";

        // ğŸ”¥ ê¸°ì¡´ ì´ë¯¸ì§€ ìˆ¨ê¸°ê¸° (ê²€ìˆ˜ ì‹œì‘ ì „ì— ë¹„ìš°ê¸°)
        document.getElementById("originalImage").style.display = "none";
        document.getElementById("detectedImage").style.display = "none";

        // ì•„ì´ì½˜ê³¼ ê²°ê³¼ ì´ë¯¸ì§€ ì‚¬ì´ì˜ ê°„ê²© ì¤„ì´ê¸°
        document.getElementById("resultContainer").style.marginTop = "-40px";

        // ê²€ìˆ˜ ì¤‘ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ (ì„ íƒ ì‚¬í•­)
        document.getElementById("resultContainer").style.display = "block";

        const fileInputData = document.getElementById("fileInput").files[0];
        const formData = new FormData();
        formData.append("file", fileInputData);

        const defaultIcon = document.getElementById("defaultIcon");
        const loadingIcon = document.getElementById("loadingIcon");

        // ê¸°ì¡´ ì•„ì´ì½˜ ìˆ¨ê¸°ê³  ìƒˆ ì•„ì´ì½˜ í‘œì‹œ
        if (defaultIcon && loadingIcon) {
            defaultIcon.style.display = "none"; // ê¸°ì¡´ ì•„ì´ì½˜ ìˆ¨ê¸°ê¸°
            loadingIcon.style.display = "block"; // ìƒˆ ì•„ì´ì½˜ ë³´ì´ê¸° (ì• ë‹ˆë©”ì´ì…˜ í¬í•¨)
        }

        try {
            const response = await fetch("/inspection/inspect", {
                method: "POST",
                body: formData
            });

            if (response.ok) {
                const result = await response.json();

                // ğŸ”¥ ìƒˆë¡œìš´ ì´ë¯¸ì§€ê°€ ë“¤ì–´ì™”ì„ ë•Œë§Œ í‘œì‹œ
                document.getElementById("originalImage").src = "data:image/jpeg;base64," + result.original_image;
                document.getElementById("detectedImage").src = "data:image/jpeg;base64," + result.detected_image;

                document.getElementById("originalImage").style.display = "block";
                document.getElementById("detectedImage").style.display = "block";

                document.getElementById("resultContainer").style.display = "block";
            } else {
                alert("ê²€ìˆ˜ ì‹¤íŒ¨!");
            }
        } catch (error) {
            alert("ì˜¤ë¥˜ ë°œìƒ!");
        } finally {
            // ê¸°ì¡´ ì•„ì´ì½˜ ë‹¤ì‹œ ë³´ì´ê³ , ìƒˆ ì•„ì´ì½˜ ìˆ¨ê¸°ê¸°
            if (defaultIcon && loadingIcon) {
                defaultIcon.style.display = "block"; // ê¸°ì¡´ ì•„ì´ì½˜ ë‹¤ì‹œ ë³´ì´ê¸°
                loadingIcon.style.display = "none"; // ë¡œë”© ì•„ì´ì½˜ ìˆ¨ê¸°ê¸°
            }
        }
    };

    document.getElementById("changeButton").addEventListener("click", function() {
        // ê²°ê³¼ ì˜ì—­ ìˆ¨ê¸°ê¸°
        document.getElementById("resultContainer").style.display = "none";

        // ì—…ë¡œë“œ í¼ ë³´ì´ê¸°
        document.getElementById("uploadForm").style.display = "block";

        // ì—…ë¡œë“œ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
        document.getElementById("uploadButton").style.display = "inline-block";

        // ğŸ”¥ íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
        fileInput.value = ""; // íŒŒì¼ ì„ íƒ í•„ë“œ ì´ˆê¸°í™”
        dropZoneText.textContent = "ì—¬ê¸°ë¡œ íŒŒì¼ì„ ëŒì–´ì˜¤ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”"; // ê¸°ì¡´ íŒŒì¼ëª… ì§€ìš°ê³  ê¸°ë³¸ ë©”ì‹œì§€ë¡œ ë³€ê²½

        // ğŸ”¥ ê¸°ì¡´ ì´ë¯¸ì§€ ì´ˆê¸°í™”
        document.getElementById("originalImage").src = "";
        document.getElementById("detectedImage").src = "";
    });

</script>
